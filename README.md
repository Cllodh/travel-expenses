# 旅行花費記錄系統

版本：v0.2

一個現代化、響應式的旅行花費記錄網頁，支援多國幣別自動換算台幣，並將資料即時寫入 Google Sheets。介面簡潔、分區明確，適合個人或團體旅遊記帳。

## v0.2 主要更新
- 國家清單改為台灣人常去的前20個，並支援台灣、澳門、香港、中國。
- KLOOK/KKDAY 欄位統一改為「票券」。
- Google Sheets 標題自動同步為最新（自動修正舊表單標題）。
- 登入後按鈕顯示「繼續登記」，未登入顯示「登入並同步」。
- 送出後自動提示並重置表單，方便連續登記。
- 登入與登出按鈕體驗與樣式優化，僅登入後顯示登出。
- UI 細節優化，說明區塊更美觀，響應式更佳。

## 主要功能特色
- 支援多國幣別，匯率自動查詢與換算
- 所有資料寫入同一 Google Sheets，方便彙整
- 響應式現代化表單，手機/桌機皆美觀
- 欄位分區明確，填寫體驗佳
- 即時計算總花費，公式透明
- 前端/後端皆有資料驗證
- 新增「保險」欄位，記錄旅遊保險金額

## 新版 Google Sheets 串接說明
- 採用 Google Identity Services (GIS) 新版登入，使用者以自己 Google 帳號登入。
- 登入後自動搜尋 Google Drive 是否已有「我的旅行花費表單」，有則直接使用，無則自動建立新表單並寫入標題。
- access token、email、spreadsheetId 皆儲存於 localStorage，保留登入狀態。
- 送出表單時自動帶出 access token 與 spreadsheetId，後端直接寫入該用戶自己的 Google Sheets。
- 若表單被刪除或 localStorage 遺失，系統會自動重新搜尋或建立新表單。
- 完善的錯誤處理，access token 過期、表單不存在、權限不足等情境皆有對應 UX 引導。
- 所有 debug alert 已移除，介面乾淨，僅於 console.log 保留開發資訊。

## 安裝與執行
1. **安裝 Python 3.8+**
2. 安裝套件：
   ```sh
   pip install -r requirements.txt
   ```
3. （新版已不需 Service Account 憑證，僅需前端 Google OAuth 設定 client_id）
4. 啟動 Flask 伺服器：
   ```sh
   python app.py
   ```
5. 於瀏覽器開啟 http://localhost:5000

## 前端表單特色
- 國家下拉選單+其他自訂，匯率自動帶出
- 日期區間選擇，天數自動計算
- 金額欄位分區排列，欄位說明清楚
- 匯率區塊即時顯示幣別
- 送出前前端驗證，回國日不可早於出發日
- 旅程花費區塊即時計算總花費

## Google Sheets 欄位說明
依照最新順序，寫入 Google Sheets 的欄位如下：

| 欄位         | 說明                         |
|--------------|------------------------------|
| 旅行國家     | 旅遊國家名稱                |
| 時間區間     | 出發日 ~ 回國日              |
| 天數         | 旅程天數                     |
| 機票         | 機票花費（TWD）              |
| 住宿         | 住宿花費（TWD）              |
| SIM          | SIM卡花費（TWD）             |
| 票券         | 行程票券（TWD）              |
| 換匯         | 換匯金額（TWD）              |
| 刷卡         | 刷卡金額（當地貨幣）         |
| 原本有的貨幣 | 出發時持有的當地貨幣         |
| 現餘         | 回國時剩餘的當地貨幣         |
| 匯率         | 1 TWD = ? 當地貨幣           |
| 總花費       | 依公式自動計算（TWD）        |
| 保險         | 旅遊保險金額（TWD）            |

## 版權與聯絡方式
- 作者：xiaoweijie18@gmail.com
- GitHub: https://github.com/xiaoweijie18 